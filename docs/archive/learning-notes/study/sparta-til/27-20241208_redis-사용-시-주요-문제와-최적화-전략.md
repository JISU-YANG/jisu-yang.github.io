---
layout: note_series
parent: Learning Notes
study: Sparta Til
chapter: 27
title: 20241208_Redis 사용 시 주요 문제와 최적화 전략
toc: true
---

## Redis 사용 시 주의사항과 해결 방법
Redis는 빠른 속도와 유연한 데이터 구조로 많은 시스템에서 사용되지만, 
잘못된 설정이나 관리 부족으로 문제를 일으킬 수 있다. 

### Redis 사용 시 발생할 수 있는 문제들
Redis 사용 시 가장 흔히 겪는 문제는 서버 과부하와 메모리 초과이다. 
첫 번째로, Redis connection에 timeout 설정이 없는 경우, 
요청이 무기한 대기 상태로 남아 pending 상태를 유발하게 된다. 
이렇게 되면 동시 접속자 수가 증가하면서 Redis 서버는 물론이고 데이터베이스까지 과부하로 인해 다운될 수 있다. 
두 번째로, 페이징 처리 과정에서 직렬화된 객체를 그대로 저장하면 Redis 메모리 용량을 초과하게 된다. 
이는 불필요한 데이터를 포함한 채 저장하기 때문이며, 결국 Redis 서버가 비정상적으로 동작하게 된다.

### 문제를 해결하는 방법
1. Connection Timeout 설정
   Redis connection에 적절한 timeout 값을 설정하면 요청이 무기한 대기 상태로 머물지 않도록 방지할 수 있다. 
이것은 자원 낭비를 줄이고 Redis 서버의 안정성을 높이는 데 중요한 역할을 한다.

2. 데이터 응답 방식 개선
   상황에 따라 데이터를 제공하지 않는 것도 하나의 방법이 될 수 있다. 
프론트엔드에서는 응답이 없을 경우 로딩 상태나 "데이터 없음"과 같은 메시지를 표시하여 사용자가 오류로 느끼지 않도록 한다. 또한, 문제 상황에서는 요청 데이터 대신 더미 데이터를 제공하여 시스템이 최소한의 구조를 유지하도록 할 수도 있다.

3. 페이징 데이터 최적화
   Redis에 저장되는 데이터의 크기를 줄이기 위해 반드시 필요한 정보만 포함하도록 객체를 경량화해야 한다. 
직렬화 전에 데이터를 필터링하거나 압축하는 방법도 고려할 수 있다. 
이러한 최적화는 Redis 메모리 사용량을 줄이고 성능 저하를 방지하는 데 효과적이다.

4. 실시간 모니터링과 알림 시스템
   Redis 메모리가 설정 용량을 초과하지 않도록 알림 시스템을 구축해야 한다. 
예를 들어, 메모리 사용량이 30GB를 초과하면 관리자에게 알림을 보내는 시스템을 설정할 수 있다. 
또한, 실시간 모니터링 도구를 활용하여 Redis 서버 상태를 점검하고 이상 발생 시 즉각 대처할 수 있는 체계를 마련해야 한다.

5. 캐시 만료와 방어벽 강화
   Redis에 저장된 오래된 데이터를 제거하기 위해 만료 시간을 전략적으로 설정하는 것이 중요하다. 
연결 수 제한을 두어 서버 과부하를 예방하고, Redis 서버 다운 시에도 대응할 수 있도록 다층적인 보호 대책을 마련해야 한다.

## 데이터 요청과 처리 최적화
### 읽기 요청 최적화
읽기 요청을 처리할 때는 Redis를 캐싱 레이어로 활용해 데이터베이스로의 I/O를 최소화해야 한다. 
읽기 전용 데이터베이스를 추가로 구성하면 데이터 변경 시 Redis 캐시가 오래된 값을 유지하는 문제가 발생할 수 있다. 
이를 해결하기 위해 데이터 변경 시 Redis의 해당 데이터를 강제로 삭제하거나 갱신하는 로직을 추가해야 한다.

### 쓰기 요청 최적화
쓰기 작업은 비동기로 큐에 저장한 뒤 나중에 처리하는 방식으로 처리 속도를 개선할 수 있다. 
이 방법은 특히 높은 트래픽 상황에서 유용하며, 사용자 요청을 즉시 처리할 수 있으므로 사용자 경험이 향상된다. 
다만, 큐에 저장된 데이터가 DB에 반영되기 전 에러로 인해 손실되지 않도록 
지속적인 모니터링과 재시도 매커니즘을 마련해야 한다.

### 배치 처리 활용
실시간으로 처리할 필요가 없는 데이터는 배치 작업으로 처리할 수 있다. 
일정 시간 동안 큐에 저장된 데이터를 한꺼번에 DB에 반영하면 효율성을 높일 수 있다. 
배치 작업 중 오류가 발생할 경우 기록하고 재시도하는 메커니즘을 마련해야 데이터 손실을 방지할 수 있다.

### 데이터 일관성 유지
Redis와 데이터베이스 간의 데이터 일관성을 유지하기 위해 
분산 트랜잭션, 이벤트 소싱, CQRS와 같은 패턴을 활용할 수 있다. 
분산 트랜잭션은 데이터의 일관성을 보장하지만 구현이 복잡하고 성능 저하를 일으킬 수 있다.
대안으로 사가 패턴을 사용하면 트랜잭션을 여러 단계로 나누어 처리하고 
실패 시 보상 트랜잭션을 실행하여 상태를 복구할 수 있다.

### 이벤트 소싱과 CQRS
이벤트 소싱은 데이터의 상태 변화를 이벤트로 저장하여 시스템의 상태를 복구하거나 변경 이력을 추적하는 데 유용하다. 
하지만 이 방식은 구현 복잡성을 높일 수 있다. 
CQRS 패턴을 함께 활용하면 명령(Command)과 조회(Query)를 분리하여 시스템 성능과 확장성을 최적화할 수 있다.

Redis를 사용할 때는 이러한 문제를 사전에 예방하고 시스템 설계를 철저히 검토하는 것이 매우 중요하다. 
적절한 설정과 관리를 통해 Redis의 장점을 극대화하고 안정적인 시스템을 유지할 수 있다.